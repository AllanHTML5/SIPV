{% extends "base.html" %}
{% block title %}{{ titulo }}{% endblock %}

{% block content %}

<h1 class="text-3xl font-bold text-slate-800 mb-6">
    {% if modo == "crear" %}➕ Nuevo Grupo{% else %}✏️ Editar Grupo{% endif %}
</h1>

<div class="bg-white shadow-xl rounded-xl p-8 max-w-5xl">

    <form method="POST" novalidate>
        {% csrf_token %}

        <!-- Nombre -->
        <label class="block mb-1 font-semibold">Nombre del grupo</label>
        <input type="text" name="name" value="{{ form.name.value|default:'' }}"
               class="w-full px-4 py-2 border rounded-lg mb-4">

        {% if form.name.errors %}
            <p class="text-red-600 text-sm">{{ form.name.errors.0 }}</p>
        {% endif %}

        <h2 class="font-semibold text-lg mt-6 mb-2">Permisos</h2>

        <div class="grid grid-cols-3 gap-4">

            <!-- Asignados -->
            <div>
                <p class="font-semibold mb-1 text-slate-700">Asignados</p>
                {{ form.permisos_asignados }}
            </div>

            <!-- Buttons -->
            <div class="flex flex-col items-center justify-center gap-3">
                <button type="button" class="px-4 py-2 bg-slate-300 rounded move-right">→</button>
                <button type="button" class="px-4 py-2 bg-slate-300 rounded move-all-right">⇒</button>
                <button type="button" class="px-4 py-2 bg-slate-300 rounded move-left">←</button>
                <button type="button" class="px-4 py-2 bg-slate-300 rounded move-all-left">⇐</button>
            </div>

            <!-- Disponibles -->
            <div>
                <p class="font-semibold mb-1 text-slate-700">Disponibles</p>
                {{ form.permisos_disponibles }}
            </div>
        </div>

        <div class="flex justify-end mt-10 gap-3">
            <a href="{% url 'authapp:grupos_lista' %}" class="px-4 py-2 bg-slate-300 rounded">Cancelar</a>
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">Guardar</button>
        </div>

    </form>
</div>

<script>
    function move(from, to) {
        [...from.selectedOptions].forEach(opt => to.appendChild(opt));
    }

    function moveAll(from, to) {
        [...from.options].forEach(opt => to.appendChild(opt));
    }

    const left = document.querySelector('[name="permisos_asignados"]');
    const right = document.querySelector('[name="permisos_disponibles"]');

    document.querySelector('.move-right').onclick = () => move(left, right);
    document.querySelector('.move-left').onclick = () => move(right, left);
    document.querySelector('.move-all-right').onclick = () => moveAll(left, right);
    document.querySelector('.move-all-left').onclick = () => moveAll(right, left);

    document.querySelector("form").onsubmit = () => {
        [...left.options].forEach(opt => opt.selected = true);
    };
</script>

{% endblock %}
