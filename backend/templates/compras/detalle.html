{% extends "base.html" %}
{% block title %}Compra #{{ compra.pk }}{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold mb-6 text-gray-800">
  Compra #{{ compra.pk }}
</h1>

<!-- TARJETA SUPERIOR -->
<div class="bg-white border border-gray-200 rounded-xl shadow p-6 mb-8">
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">

    <!-- Proveedor -->
    <div>
      <p class="text-sm text-gray-500 font-semibold">Proveedor</p>
      <p class="text-lg text-gray-900 font-medium">{{ compra.proveedor.nombre }}</p>
    </div>

    <!-- Fecha -->
    <div>
      <p class="text-sm text-gray-500 font-semibold">Fecha</p>
      <p class="text-lg text-gray-900">{{ compra.fecha|date:"M. d, Y" }}</p>
    </div>

    <!-- Estado -->
    <div>
      <p class="text-sm text-gray-500 font-semibold">Estado</p>

      {% if compra.estado == "BORRADOR" %}
        <span class="px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 font-semibold">BORRADOR</span>
      {% elif compra.estado == "CONFIRMADA" %}
        <span class="px-3 py-1 text-sm rounded-full bg-emerald-200 text-emerald-700 font-semibold">CONFIRMADA</span>
      {% elif compra.estado == "ANULADA" %}
        <span class="px-3 py-1 text-sm rounded-full bg-red-200 text-red-700 font-semibold">ANULADA</span>
      {% endif %}
    </div>

  </div>
</div>

<!-- TABLA DE PRODUCTOS -->
<div class="bg-white border border-gray-200 rounded-xl shadow p-6 mb-8">

  <table class="w-full text-sm">
    <thead class="border-b border-gray-300 text-gray-600 uppercase text-xs">
      <tr>
        <th class="py-2 text-left">Producto</th>
        <th class="text-center">Cantidad</th>
        <th class="text-center">Costo unit.</th>
        <th class="text-center">ISV %</th>
        <th class="text-right">Subtotal</th>
        <th class="text-right">Impuesto</th>
      </tr>
    </thead>

    <tbody class="text-gray-800">
      {% for d in detalles %}
      <tr class="border-b border-gray-200">
        <td class="py-2">{{ d.obj.producto.nombre }}</td>
        <td class="text-center">{{ d.obj.cantidad }}</td>
        <td class="text-center">L {{ d.obj.costo_unitario|floatformat:2 }}</td>
        <td class="text-center">15%</td>

        <td class="text-right">L {{ d.subtotal|floatformat:2 }}</td>
        <td class="text-right">L {{ d.impuesto|floatformat:2 }}</td>
      </tr>
      {% endfor %}
    </tbody>

    <!-- Totales -->
    <tfoot class="text-gray-900">
      <tr>
        <td colspan="4"></td>
        <td class="text-right font-semibold pt-3">
          Subtotal: L {{ compra.subtotal|floatformat:2 }}
        </td>
        <td class="text-right font-semibold pt-3">
          Impuesto: L {{ compra.impuesto|floatformat:2 }}
        </td>
      </tr>
      <tr>
        <td colspan="4"></td>
        <td colspan="2" class="text-right text-lg font-bold text-emerald-700 pt-1">
          Total L {{ compra.total|floatformat:2 }}
        </td>
      </tr>
    </tfoot>

  </table>

</div>

<!-- BOTONES -->
<div class="flex gap-3">

  <a href="{% url 'compras:dashboard' %}" 
     class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md shadow">
    Volver
  </a>

  {% if compra.estado != "ANULADA" %}
  <a href="{% url 'compras:anular' compra.pk %}"
     class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md shadow">
    Anular compra
  </a>
  {% endif %}

  {% if compra.estado == "BORRADOR" %}
  <a href="{% url 'compras:confirmar' compra.pk %}"
     class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-md shadow">
    Confirmar
  </a>
  {% endif %}

{% if compra.factura_id %}
<a href="{% url 'facturas:ticket' compra.factura_id %}"
   class="block bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-lg text-center mt-3 text-lg font-semibold">
    ðŸ§¾ Ticket
</a>
{% endif %}


</div>

{% endblock %}
