{% extends "base.html" %}
{% block title %}Compras — Listado{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold mb-6 text-gray-800">Compras</h1>

<div class="bg-white rounded-xl p-6 shadow">

  <!-- HEADER BAR -->
  <div class="flex items-center justify-between mb-5">
    <a href="{% url 'compras:crear' %}" 
       class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white shadow">
      + Nueva compra
    </a>
  </div>

  <!-- FILTROS -->
  <form method="get" class="grid grid-cols-1 md:grid-cols-5 lg:grid-cols-6 gap-4 mb-6">

    <div>
      <label class="text-sm text-gray-600">Proveedor</label>
      <select name="proveedor" class="w-full border rounded px-3 py-2">
        <option value="">Todos</option>
        {% for p in proveedores %}
          <option value="{{ p.id }}" {% if proveedor == p.id|stringformat:"s" %}selected{% endif %}>
            {{ p.nombre }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label class="text-sm text-gray-600">Estado</label>
      <select name="estado" class="w-full border rounded px-3 py-2">
        <option value="">Todos</option>
        <option value="BORRADOR" {% if estado == "BORRADOR" %}selected{% endif %}>Borrador</option>
        <option value="CONFIRMADA" {% if estado == "CONFIRMADA" %}selected{% endif %}>Confirmada</option>
        <option value="ANULADA" {% if estado == "ANULADA" %}selected{% endif %}>Anulada</option>
      </select>
    </div>

    <div>
      <label class="text-sm text-gray-600">Fecha desde</label>
      <input type="date" name="desde" value="{{ desde }}" class="w-full border rounded px-3 py-2">
    </div>

    <div>
      <label class="text-sm text-gray-600">Fecha hasta</label>
      <input type="date" name="hasta" value="{{ hasta }}" class="w-full border rounded px-3 py-2">
    </div>

    <div>
      <label class="text-sm text-gray-600">Total ≥</label>
      <input type="number" step="0.01" name="total_min" value="{{ total_min }}" 
             class="w-full border rounded px-3 py-2">
    </div>

    <div>
      <label class="text-sm text-gray-600">Total ≤</label>
      <input type="number" step="0.01" name="total_max" value="{{ total_max }}" 
             class="w-full border rounded px-3 py-2">
    </div>

    <div class="md:col-span-5 lg:col-span-6 text-right">
      <button type="submit"
              class="bg-slate-900 hover:bg-black text-white px-4 py-2 rounded shadow">
        Filtrar
      </button>
    </div>

  </form>

  <!-- TABLA -->
  <div class="overflow-x-auto">
    <table class="w-full text-sm text-gray-800">
      <thead class="border-b bg-gray-50 text-gray-600 uppercase text-xs">
        <tr>
          <th class="py-2">Fecha</th>
          <th>Proveedor</th>
          <th>Estado</th>
          <th class="text-right">Subtotal</th>
          <th class="text-right">Impuesto</th>
          <th class="text-right">Total</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        {% for c in compras %}
        <tr class="border-b hover:bg-gray-50">
          <td class="py-2">{{ c.fecha|date:"M. d, Y" }}</td>
          <td>{{ c.proveedor.nombre }}</td>

          <td>
            {% if c.estado == "BORRADOR" %}
              <span class="px-2 py-1 text-xs rounded bg-gray-200 text-gray-700">Borrador</span>
            {% elif c.estado == "CONFIRMADA" %}
              <span class="px-2 py-1 text-xs rounded bg-emerald-200 text-emerald-700">Confirmada</span>
            {% else %}
              <span class="px-2 py-1 text-xs rounded bg-red-200 text-red-700">Anulada</span>
            {% endif %}
          </td>

          <td class="text-right">L {{ c.subtotal|floatformat:2 }}</td>
          <td class="text-right">L {{ c.impuesto|floatformat:2 }}</td>
          <td class="text-right font-semibold">L {{ c.total|floatformat:2 }}</td>

          <td>
            <a href="{% url 'compras:detalle' c.pk %}"
               class="text-blue-600 hover:underline">
              Ver
            </a>
          </td>
        </tr>

        {% empty %}
        <tr>
          <td colspan="7" class="text-center py-4 text-gray-500">No hay registros</td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>

</div>
{% endblock %}
